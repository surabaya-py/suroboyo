var $jscomp={scope:{},findInternal:function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var h=a[e];if(b.call(c,h,e,a))return{i:e,v:h}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
(function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(c){function d(){this._type="instance";!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var h=new this;a=!1;for(var f in c)h[f]="function"==typeof c[f]&&"function"==typeof e[f]&&b.test(c[f])?function(a,b){return function(){var f=this._super;this._super=e[a];var c=b.apply(this,arguments);this._super=f;return c}}(f,c[f]):c[f];d.prototype=h;d._type="class";d.prototype.constructor=
d;d.extend=arguments.callee;return d}})();
(function(a,b,c){var d=a.document,e=a.location;c=function(f,c){var d=f.split("."),g=a,e,h,k,l;e=0;for(h=d.length;e<h;++e){k=d[e];l=e===h-1;if(void 0===g[k])g[k]=l&&c?c:{};else{if("object"!==b.type(g[k]))throw Error(k+" is not object.");if(l&&c)if("object"===b.type(c))b.extend(!0,g[k],c);else throw Error(c+" value cannot extend.");}g=g[k]}g.ns||(g.ns=f.toLowerCase().replace(/\.(\w)/g,function(a,b){return b.toUpperCase()}));return g};c("baka",{w:b(a),d:b(d),h:b("html"),ua:{},ns:c});baka.config=function(a,
c){if("object"!==b.type(a)){if(!c)return baka.config[a];a={};a[a]=c}for(var f in a)baka.config[f]="object"===b.type(baka.config[f])&&"object"===b.type(a[f])?b.extend(!0,baka.config[f],a[f]):a[f];return baka};baka.config({text:{},templates:{},timeout:3E4,apiCache:3E4});baka.id=function(a){return function(){return a++ +"."+ +new Date}}(0);(function(){var a=navigator.userAgent.toLowerCase();/(?:msie|trident)/.test(a)?(baka.ua.ie=!0,baka.ua.v=+(/(?:msie|rv:?)\s?([\d\.]+)/.exec(a)||[])[1]):/firefox/.test(a)?
baka.ua.firefox=!0:/chrome/.test(a)?baka.ua.chrome=!0:/safari/.test(a)&&(baka.ua.safari=!0);if(baka.ua.chrome||baka.ua.safari)baka.ua.webkit=!0})();(function(){var c=!!a.console;baka.log=c?function(){if(arguments.length){var a=b.makeArray(arguments);a.unshift((new Date).toTimeString().slice(0,8));"apply"in console.log?console.log.apply(console,a):console.dir?console.dir(a):console.log(a)}}:function(){if(arguments.length){var a=b.makeArray(arguments);a.unshift((new Date).toTimeString().slice(0,8));
b("#console").append(a.join(" "))}};c||(a.console={log:function(){}});var g=function(a,c){var f=a+" ["+c+"]";return function(){arguments.length&&b.makeArray(arguments).unshift(f)}},d=function(a){return{setDefaultLevel:function(){},trace:g("trace",a),debug:g("debug",a),info:g("info",a),warn:g("warn",a),error:g("error",a)}};baka.logger=function(a){baka.logger.loggers[a]||(baka.logger.loggers[a]=d(a));return baka.logger.loggers[a]};baka.logger.loggers={}})();baka.letterCase=function(a,b){a=a.replace(/_([-A-Z\d]+)/g,
"$1").replace(/(^|.)([-A-Z\d]+)/g,"$1_$2").replace(/([A-Z]+)([A-Z][a-z0-9])/g,"$1_$2").replace(/-/g,"");switch(b){case "css":a=a.replace(/_{2,}/g,"").replace(/_/g,"-").toLowerCase();break;case "class":a=a.replace(/_([a-z]|[0-9])/ig,function(a,b){return b.toUpperCase()});a=a.charAt(0).toUpperCase()+a.slice(1);break;case "prop":a=a.replace(/_([a-z]|[0-9])/ig,function(a,b){return b.toUpperCase()}).replace(/^[A-Z]+/,function(a,b){return b.toLowerCase()});break;default:a=a.toLowerCase()}return a};baka.truncate=
function(a,b){a||(a="");return a.length>b?a.slice(0,b)+"...":a};var h=/^(-?\d+)(\d{3})/;baka.format=function(a){for(a=a.toString();a!==(a=a.replace(h,"$1,$2")););return a};baka.padding=function(a,b){b||(b=2);for(var c=a.toString().split(".")[0].length;c++<b;)a="0"+a;return a};baka.unique=function(a){a.filter(function(a,b,c){return c.indexOf(a)===b})};c("baka.query",{slim:function(a){var b,c,d={};for(b in a)c=a[b],null!==c&&void 0!==c&&(d[b]=c);return d},build:function(b,c){var d=a.encodeURIComponent,
f,g=[];1===arguments.length&&(c=b,b=e.pathname);c=baka.query.slim(c);for(f in c)g.push(d(f)+"="+d(c[f]));g=g.join("&");return b+(g.length?(-1===b.indexOf("?")?"?":"&")+g:"")},replace:function(c,d,h){c=baka.query.build(b.extend(baka.query.parse(),c))+(!1!==h?e.hash:"");c!==e.href&&d&&a.history.replaceState&&a.history.replaceState(null,"",c);return c},parse:function(b){b=(b||a.location.search).replace(/^[^?]*\?/,"").replace(/\+/g," ").split("&");var c=a.decodeURIComponent,d=/^([^=]+)=(.*)$/,f,e,h={};
for(f=0;e=b[f];++f)e=d.exec(e)||[],e[1]&&(h[c(e[1])]=e[2]&&c(e[2]));return h}});baka.query.base=baka.query.parse();c("baka.html",{escape:function(a){return a.toString().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescape:function(a){return a.toString().replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},title:function(){var a=d.title;return function(c){var f=d.title;c="function"===b.type(c)?c(f,a):c;c!==f&&(d.title=null===
c?pixiv.title.original:c||"")}}(),iframe:function(a,c){a=baka.query.build(a,c);return b('<iframe src="'+a+'" marginwidth="0" marginheight="0" frameborder="0" allowtransparency="true" scrolling="no"></iframe>')}})})(window,jQuery,Class);
baka.ns("kara.fun",{listObj:null,setup:function(a,b){var c=this.findMap(a);baka.logger("kara.fun").debug(c);this.listObj=[];this.splitInit(c,b);return this.listObj},findMap:function(a){return _.map(a,function(a,c){return _.assign({name:c},a)})},find:function(a,b){return a instanceof Object&&"object"===$.type(a)?_.filter(a,function(a){return null===a?!1:a[b]}):!1},splitInit:function(a,b){for(var c in a)if(a[c]instanceof Object&&"object"===$.type(a[c])){var d=this.find(a[c],b);0<d.length&&this.listObj.push(d);
this.splitInit(a[c],b)}}});$.handlebars({templatePath:"static/templates",templateExtension:"hbs"});$.extend($.fn.textbox.defaults.inputEvents,{keyup:function(a){a=$(a.data.target);a.textbox("setValue",a.textbox("getText"))}});
kara.app=Class.extend({init:function(a){$.extend(this,a);this.setupReady()},setupReady:function(){_.flatMap(kara.fun.setup(kara,"init"),function(a){for(var b in a)a[b].init()});baka.d.on("click","._action",function(a){a.preventDefault();kara.ui.actions["do"](this)});$("._action").on("click",function(a){a.preventDefault();kara.ui.actions["do"](this)});baka.d.on("click","form._ajax input[type=reset]",function(a){a.preventDefault();$(this).closest(".easyui-dialog").dialog("destroy");kara.ui.container.delete_container()});
baka.d.on("click","form._ajax input[type=submit]",function(a){a.preventDefault();kara.ui.forms.submit($(this).closest("form._ajax"))});baka.d.on("click",".flashbar",function(a){a.preventDefault();$(".flashbar").html("")})}});$(document).ready(function(){new kara.app});kara.containers=[];
baka.ns("kara.ui.container",{add_container:function(a){a.container&&kara.containers.push(a.container)},get_container:function(){return 0<kara.containers.length?kara.containers[kara.containers.length-1]:null},delete_container:function(){kara.containers.pop()},refresh_container:function(a){a||(a=kara.containers.pop());a=$(a);switch(this.get_container_type($(a))){case "datagrid":a.datagrid("reload");break;case "treegrid":a.treegrid("reload");break;case "combobox":a.combobox("reload");break;case "combogrid":a.combogrid("grid").datagrid("reload")}},
save_container_response:function(a){var b=this.get_container();$(b).data("response",a)},container_action:function(a){this.add_container(a);a=kara.ui.helpers.get_action_url(a);$.post(a).always(function(){this.refresh_container(null)})},container_picker:function(a){this.add_container(a);a=$(this.get_container());var b=this.get_selected(a);b?(a.closest(".easyui-dialog").dialog("destroy"),this.delete_container(),this.save_container_response(b.id)):kara.ui.actions.dialogopen("/system_need_select_row")},
get_selected:function(a){var b=null;switch(this.get_container_type(a)){case "datagrid":b=a.datagrid("getSelected");break;case "treegrid":b=a.treegrid("getSelected");break;case "combogrid":b=a.combogrid("grid").datagrid("getSelected")}return b},get_checked:function(a){var b=null;switch(this.get_container_type(a)){case "datagrid":b=a.datagrid("getChecked");break;case "treegrid":b=a.treegrid("getChecked")}return b},get_container_type:function(a){var b=null;a.hasClass("easyui-datagrid")?b="datagrid":
a.hasClass("easyui-treegrid")?b="treegrid":a.hasClass("easyui-combobox")?b="combobox":a.hasClass("easyui-combotree")?b="combotree":a.hasClass("easyui-combogrid")&&(b="combogrid");return b}});
baka.ns("kara.ui.helpers",{get_action_url:function(a){var b=$(kara.ui.container.get_container()),c=a.url,d=a.param?a.param:"id";switch(a.property){case "with_row":b=kara.ui.container.get_selected(b);if(!b){kara.ui.actions.dialog_url("/system_need_select_row");return}c=-1==c.indexOf("?")?c+"?"+d+"="+b[d]:c+"&"+d+"="+b[d];break;case "with_rows":b=kara.ui.container.get_checked(b);if(!b.length){kara.ui.actions.dialog_url("/system_need_select_rows");return}var e=[];$.each(b,function(a,b){e.push(b[d])});
c=-1==c.indexOf("?")?c+"?"+d+"="+e.join():c+"&"+d+"="+e.join()}(a=a.params_str?a.params_str:null)&&(c=-1==c.indexOf("?")?c+"?"+a:c+"&"+a);return c},get_params_str:function(a){a=a.params_str?a.params_str:null;$.isFunction(a)&&(a=a());console.log(params.str);return a},disable_inputs:function(a){return $(a).find("form").hasClass("readonly")?(a=$("<div>").html(a),a=this.disable_obj_inputs(a),a.html()):a},disable_obj_inputs:function(a){a.find(":input").attr("disabled",!0);a.find("[type=reset]").attr("disabled",
!1);a.find("[type=submit]").addClass("disable");return a},clear_inputs:function(a){$(a).find(".easyui-datebox").datebox("clear");$(a).find(".easyui-datetimebox").datetimebox("clear");$(a).find(".easyui-combobox").combobox("clear");$(a).find(".easyui-combogrid").combogrid("clear");$(a).find(".easyui-combotree").combotree("clear");$(a).find(".easyui-numberbox").numberbox("clear")},add_datebox_clear_btn:function(a){var b=$.extend([],$.fn.datebox.defaults.buttons);b.splice(1,0,{text:"Clear",handler:function(a){$(a).datebox("clear")}});
$(a).datebox({buttons:b})},add_datetimebox_clear_btn:function(a){var b=$.extend([],$.fn.datetimebox.defaults.buttons);b.splice(1,0,{text:"Clear",handler:function(a){$(a).datetimebox("clear")}});$(a).datetimebox({buttons:b})},get_higher_zindex:function(){var a=-999;$("*").each(function(){var b=parseInt($(this).css("z-index"),10);b&&a<b&&(a=b)});return a},getKeyByValue:function(a,b){var c=null,d;for(d in a)if(a.hasOwnProperty(d)&&a[d]===b){c=d;break}return c},payment_indicator:function(a){var b=$("<span>").html(a+
"%");100<a&&(a=100);a=$("<div>").css("width",a+"%").html("&nbsp;");a=$("<div>").addClass("payment-indicator tc").css("width","100%").append(b).append(a);a=$("<div>").append(a);return a.html()},dt_formatter:function(a,b){return Date.format(a,b)},dt_parser:function(a,b){return a?Date.parseFormatted(a,b):new Date},get_icon:function(a){return $("<span/>").addClass("fa "+a)},datagrid_resource_cell_styler:function(){return"background-color:#ededed"},status_formatter:function(a){if(a){var b=$("<span/>").html(a.title);
b.addClass("status-label "+a.key);return $("<div/>").append(b).html()}},account_item_type_formatter:function(a){if(a){var b=$("<span/>").addClass("fa mr05"),c=$("<span/>").html(a.title);switch(a.key){case "revenue":b.addClass("fa-long-arrow-right");break;case "expenses":b.addClass("fa-long-arrow-left");break;default:b.addClass("fa-arrows-h")}return $("<div/>").append(b).append(c).html()}},format_download_link:function(a){var b=$("<span/>").addClass("fa fa-download");a=$('<a target="_blank"/>').attr("href",
a).append(b);return $("<div/>").append(a).html()},is_undefined:function(a){return"undefined"==typeof a}});
baka.ns("kara.ui.forms",{show_status_bar_info:function(a,b,c){var d=$("<i>");"error"==b&&(a.addClass("error"),d.attr("class","fa fa-exclamation-circle fa-lg"));"info"==b&&(a.removeClass("error"),d.attr("class","fa fa-info-circle fa-lg"));"success"==b&&(a.removeClass("error"),d.attr("class","fa fa-check-circle fa-lg"));"loading"==b&&(a.removeClass("error"),d.attr("class","fa fa-spinner fa-spin fa-lg"));a.html(d).append("&nbsp;"+c)},is_form_errors:function(a){return kara.ui.helpers.is_undefined(a)?
!1:!0},show_form_errors:function(a,b){var c=this;c.is_form_errors(b)&&$.each(b,function(b,e){c.set_field_error(a,b,e)})},set_field_error:function(a,b,c){var d="[data-name='"+b+"']";a.find("input[name='"+b+"']").addClass("_invalid");a.find(d+" span").html(c);a.find(d+" i").tooltip({content:c,position:"right"})},clear_form_errors:function(a){a.find(".inputfield ._invalid").removeClass("_invalid")},submit:function(a){var b=this;$("#_progress_").dialog("open");a.form("submit",{url:a.attr("action"),success:function(c){c=
$.parseJSON(c);console.log(c);b.clear_form_errors(a);if(!kara.ui.helpers.is_undefined(c.error_message))b.show_form_errors(a,c.errors);else if(!kara.ui.helpers.is_undefined(c.redirect)){window.location.href=c.redirect;return}$("#_progress_").dialog("close")},onSubmit:function(){console.log("form[onSubmit] ---")},onLoadSuccess:function(){return!1},onLoadError:function(){console.log("form[onLoadError] ---")}})}});
baka.ns("kara.ui.fields",{field:null,opts:null,init:function(){$("[data-k-field]").each(function(){var a=this;this.field=$(this).data("k-field");this.opts=$.parser.parseOptions(this);console.log(kara.fun.setup(kara.ui,"setup"));_.map(kara.fun.setup(kara.ui,"setup"),function(b){console.log(a.opts);console.log(b);for(var c in b)console.log(a.opts),b[c].setup(a,a.opts)})})}});
baka.ns("kara.ui.actions",{init:function(){console.log("kara.ui.actions");baka.logger("kara.ui.actions").debug("init setup")},blank_open:function(a){kara.container.add_container(a);a=kara.ui.helpers.get_action_url(a);window.open(a,"_tab");kara.ui.container.delete_container()},dialog_open:function(a){kara.ui.container.add_container(a);a=kara.ui.helpers.get_action_url(a);this.dialog_url(a)},dialog_url:function(a){$("#_progress_").dialog("open");$("#_dialog_").load(a,function(a){a=kara.ui.helpers.disable_inputs(a);
$("#_dialog_").html(a);$("#_progress_").dialog("close");$.parser.parse("#_dialog_")})},tab_open:function(a){var b=a.url.trim();if(b&&"/"!=b){a=a.title;var c=$("#_tabs_");c.tabs("exists",a)?c.tabs("select",a):c.tabs("add",{title:a,selected:!0,closable:!0,href:b,extractor:function(a){return a=$.fn.panel.defaults.extractor(a)},tools:[{iconCls:"icon-mini-refresh",handler:function(){var a=$(this).closest("li"),a=$(this).closest("ul").find("li").index(a);$("#_tabs_").tabs("getTab",a).panel("refresh")}}]})}},
"do":function(a){var b=$(a).data("k-action");if("undefined"!==typeof b)switch(a=$.parser.parseOptions(a),b){case "tab_open":this.tab_open(a);break;case "dialog_open":this.dialog_open(a);break;case "blank_open":this.blank_open(a);break;case "refresh":kara.ui.container.add_container(a);kara.ui.container.refresh_container(null);break;case "container_action":kara.ui.container.container_action(a);break;case "container_picker":kara.ui.container.container_picker(a)}}});
baka.ns("kara.ui.dropdown",{init:function(){$("[data-dropdown]").each(function(){$(this).on("click",function(){$(this).siblings(".dropdown-menu").toggleClass("show-menu")})})}});var timeout=[];
baka.ns("kara.ui.fields.searchbox",{setup:function(a,b){function c(a,b){var c=[],e=$(a);e.val().length<parseInt(b.max)?b.dropdown.removeClass("search-box-dropdown--open").addClass("search-box-dropdown"):(b.dropdown.removeClass("search-box-dropdown").addClass("search-box-dropdown--open"),c.push(e.val()),clearTimeout(timeout[b.id]),timeout[b.id]=setTimeout(function(){d(b,c.join(" "));b.terms.val(c.join(" "))},200))}function d(a,b){var c=a.dropdown.find("ul.search-box-options");$.ajax({url:a.url,type:a.method,
data:{q:b},success:function(a){c.render("options",a)},error:function(){console.log("failed to get an URI")}})}var e={group:$(a).find(".searchbox"),input:$(a).find("input"),terms:$(a).find("input[type=hidden]"),dropdown:$(a).find(".search-box-dropdown"),max:b.size||0,url:b.url||"",method:b.method||"POST",id:b.id},h=$("#"+e.id);h.on("propertychange.k input.k change.k",function(){c(this,e)}).trigger("change.k");h.on("focus",function(){h.trigger("change.k")});baka.d.on("click",".search-box-options",function(a){a.preventDefault();
0>e.dropdown.find("li.search-box-option a").index(a.target)||(e.input.focus(),e.input.val(""),kara.ui.actions["do"](a.target),e.dropdown.removeClass("search-box-dropdown--open").addClass("search-box-dropdown"),clearTimeout(timeout[e.id]))})}});
